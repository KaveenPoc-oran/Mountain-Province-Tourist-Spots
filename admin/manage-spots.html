<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Manage Tourist Spots</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="assets/css/admin.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <div class="admin-wrapper">
        <!-- Sidebar (same as dashboard) -->
        <nav class="sidebar">
            <div class="sidebar-header">
                <h4><i class="fas fa-mountain"></i> Admin Panel</h4>
                <p>Mountain Province Tourism</p>
            </div>
            <ul class="sidebar-menu">
                <li><a href="dashboard.html"><i class="fas fa-tachometer-alt"></i> Dashboard</a></li>
                <li class="active"><a href="manage-spots.html"><i class="fas fa-map-marker-alt"></i> Manage Spots</a></li>
                <li><a href="#" onclick="logout()"><i class="fas fa-sign-out-alt"></i> Logout</a></li>
            </ul>
            <div class="sidebar-footer">
                <div class="user-info">
                    <i class="fas fa-user-circle fa-2x"></i>
                    <div>
                        <strong id="adminName"></strong>
                        <small>Administrator</small>
                    </div>
                </div>
            </div>
        </nav>

        <!-- Main Content -->
        <main class="main-content">
            <div class="top-bar">
                <div class="top-bar-left">
                    <h3>Manage Tourist Spots</h3>
                    <p>Add, edit, or delete destinations</p>
                </div>
                <button class="btn btn-success" data-bs-toggle="modal" data-bs-target="#spotModal" onclick="clearForm()">
                    <i class="fas fa-plus"></i> Add New Spot
                </button>
            </div>

            <!-- Spots Table -->
            <div class="content-section">
                <div class="table-responsive">
                    <table class="table table-hover">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Name</th>
                                <th>Municipality</th>
                                <th>Category</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="spotsTableBody">
                            <!-- Populated by JS -->
                        </tbody>
                    </table>
                </div>
            </div>
        </main>
    </div>

    <!-- Add/Edit Modal -->
    <div class="modal fade" id="spotModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <form id="spotForm">
                    <div class="modal-header">
                        <h5 class="modal-title" id="modalTitle">Add Tourist Spot</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                    </div>
                    <div class="modal-body">
                        <input type="hidden" id="spotId">
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Name *</label>
                                <input type="text" class="form-control" id="name" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Municipality *</label>
                                <select class="form-control" id="municipality" required>
                                    <option value="">Select</option>
                                    <option>Sagada</option>
                                    <option>Bontoc</option>
                                    <option>Barlig</option>
                                    <option>Sadanga</option>
                                    <option>Bauko</option>
                                    <option>Tadian</option>
                                </select>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Category *</label>
                            <input type="text" class="form-control" id="category" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Description *</label>
                            <textarea class="form-control" id="description" rows="3" required></textarea>
                        </div>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Entrance Fee</label>
                                <input type="text" class="form-control" id="entrance_fee">
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Operating Hours</label>
                                <input type="text" class="form-control" id="operating_hours">
                            </div>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Location (Address)</label>
                            <input type="text" class="form-control" id="location">
                        </div>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Latitude</label>
                                <input type="number" step="any" class="form-control" id="lat">
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Longitude</label>
                                <input type="number" step="any" class="form-control" id="lng">
                            </div>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Image URL</label>
                            <input type="text" class="form-control" id="image" placeholder="assets/images/spot.jpg">
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Cultural Protocols</label>
                            <textarea class="form-control" id="cultural_protocols" rows="2"></textarea>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Safety Guidelines</label>
                            <textarea class="form-control" id="safety_guidelines" rows="2"></textarea>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                        <button type="submit" class="btn btn-primary">Save Spot</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="assets/js/admin.js"></script>
    <script>
        // Protect page
        if (!isAuthenticated()) {
            window.location.href = 'login.html';
        }

        // Display admin name
        const adminUser = JSON.parse(sessionStorage.getItem('adminUser') || '{}');
        if (adminUser.name) document.getElementById('adminName').innerText = adminUser.name;

        // Load table
        function loadSpotsTable() {
            const spots = getSpots();
            let html = '';
            spots.forEach(spot => {
                html += `<tr>
                    <td>${spot.id}</td>
                    <td>${spot.name}</td>
                    <td>${spot.municipality}</td>
                    <td>${spot.category}</td>
                    <td>
                        <button class="btn btn-sm btn-warning" onclick="editSpot(${spot.id})"><i class="fas fa-edit"></i> Edit</button>
                        <button class="btn btn-sm btn-danger" onclick="deleteSpotHandler(${spot.id})"><i class="fas fa-trash"></i> Delete</button>
                    </td>
                </tr>`;
            });
            document.getElementById('spotsTableBody').innerHTML = html;
        }

        function clearForm() {
            document.getElementById('spotForm').reset();
            document.getElementById('spotId').value = '';
            document.getElementById('modalTitle').innerText = 'Add Tourist Spot';
        }

        function editSpot(id) {
            const spots = getSpots();
            const spot = spots.find(s => s.id == id);
            if (spot) {
                document.getElementById('spotId').value = spot.id;
                document.getElementById('name').value = spot.name;
                document.getElementById('municipality').value = spot.municipality;
                document.getElementById('category').value = spot.category;
                document.getElementById('description').value = spot.description;
                document.getElementById('entrance_fee').value = spot.entrance_fee || '';
                document.getElementById('operating_hours').value = spot.operating_hours || '';
                document.getElementById('location').value = spot.location || '';
                document.getElementById('lat').value = spot.lat || '';
                document.getElementById('lng').value = spot.lng || '';
                document.getElementById('image').value = spot.image || '';
                document.getElementById('cultural_protocols').value = spot.cultural_protocols || '';
                document.getElementById('safety_guidelines').value = spot.safety_guidelines || '';
                document.getElementById('modalTitle').innerText = 'Edit Tourist Spot';
                new bootstrap.Modal(document.getElementById('spotModal')).show();
            }
        }

        function deleteSpotHandler(id) {
            if (confirm('Are you sure you want to delete this spot?')) {
                deleteSpot(id);
                loadSpotsTable();
            }
        }

        document.getElementById('spotForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const spotData = {
                name: document.getElementById('name').value,
                municipality: document.getElementById('municipality').value,
                category: document.getElementById('category').value,
                description: document.getElementById('description').value,
                entrance_fee: document.getElementById('entrance_fee').value,
                operating_hours: document.getElementById('operating_hours').value,
                location: document.getElementById('location').value,
                lat: parseFloat(document.getElementById('lat').value) || null,
                lng: parseFloat(document.getElementById('lng').value) || null,
                image: document.getElementById('image').value,
                cultural_protocols: document.getElementById('cultural_protocols').value,
                safety_guidelines: document.getElementById('safety_guidelines').value
            };

            const id = document.getElementById('spotId').value;
            if (id) {
                updateSpot(id, spotData);
            } else {
                addSpot(spotData);
            }

            bootstrap.Modal.getInstance(document.getElementById('spotModal')).hide();
            loadSpotsTable();
        });

        loadSpotsTable();
    </script>
</body>
</html>